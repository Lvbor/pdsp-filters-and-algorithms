#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define SIGNAL_LENGTH 320
#define IMPULSE_RESPONSE_LENGTH 29
#define M_PI 3.14159265358979323846
#define ECG_LENGTH 640
#define ECG_LENGTH_2 501
#define KERNEL_LENGTH 29

double InputSignal_f32_1kHz_15kHz[SIGNAL_LENGTH] =
{
+0.0000000000f, +0.5924659585f, -0.0947343455f, +0.1913417162f, +1.0000000000f, +0.4174197128f, +0.3535533906f, +1.2552931065f,
+0.8660254038f, +0.4619397663f, +1.3194792169f, +1.1827865776f, +0.5000000000f, +1.1827865776f, +1.3194792169f, +0.4619397663f,
+0.8660254038f, +1.2552931065f, +0.3535533906f, +0.4174197128f, +1.0000000000f, +0.1913417162f, -0.0947343455f, +0.5924659585f,
-0.0000000000f, -0.5924659585f, +0.0947343455f, -0.1913417162f, -1.0000000000f, -0.4174197128f, -0.3535533906f, -1.2552931065f,
-0.8660254038f, -0.4619397663f, -1.3194792169f, -1.1827865776f, -0.5000000000f, -1.1827865776f, -1.3194792169f, -0.4619397663f,
-0.8660254038f, -1.2552931065f, -0.3535533906f, -0.4174197128f, -1.0000000000f, -0.1913417162f, +0.0947343455f, -0.5924659585f,
+0.0000000000f, +0.5924659585f, -0.0947343455f, +0.1913417162f, +1.0000000000f, +0.4174197128f, +0.3535533906f, +1.2552931065f,
+0.8660254038f, +0.4619397663f, +1.3194792169f, +1.1827865776f, +0.5000000000f, +1.1827865776f, +1.3194792169f, +0.4619397663f,
+0.8660254038f, +1.2552931065f, +0.3535533906f, +0.4174197128f, +1.0000000000f, +0.1913417162f, -0.0947343455f, +0.5924659585f,
+0.0000000000f, -0.5924659585f, +0.0947343455f, -0.1913417162f, -1.0000000000f, -0.4174197128f, -0.3535533906f, -1.2552931065f,
-0.8660254038f, -0.4619397663f, -1.3194792169f, -1.1827865776f, -0.5000000000f, -1.1827865776f, -1.3194792169f, -0.4619397663f,
-0.8660254038f, -1.2552931065f, -0.3535533906f, -0.4174197128f, -1.0000000000f, -0.1913417162f, +0.0947343455f, -0.5924659585f,
+0.0000000000f, +0.5924659585f, -0.0947343455f, +0.1913417162f, +1.0000000000f, +0.4174197128f, +0.3535533906f, +1.2552931065f,
+0.8660254038f, +0.4619397663f, +1.3194792169f, +1.1827865776f, +0.5000000000f, +1.1827865776f, +1.3194792169f, +0.4619397663f,
+0.8660254038f, +1.2552931065f, +0.3535533906f, +0.4174197128f, +1.0000000000f, +0.1913417162f, -0.0947343455f, +0.5924659585f,
+0.0000000000f, -0.5924659585f, +0.0947343455f, -0.1913417162f, -1.0000000000f, -0.4174197128f, -0.3535533906f, -1.2552931065f,
-0.8660254038f, -0.4619397663f, -1.3194792169f, -1.1827865776f, -0.5000000000f, -1.1827865776f, -1.3194792169f, -0.4619397663f,
-0.8660254038f, -1.2552931065f, -0.3535533906f, -0.4174197128f, -1.0000000000f, -0.1913417162f, +0.0947343455f, -0.5924659585f,
-0.0000000000f, +0.5924659585f, -0.0947343455f, +0.1913417162f, +1.0000000000f, +0.4174197128f, +0.3535533906f, +1.2552931065f,
+0.8660254038f, +0.4619397663f, +1.3194792169f, +1.1827865776f, +0.5000000000f, +1.1827865776f, +1.3194792169f, +0.4619397663f,
+0.8660254038f, +1.2552931065f, +0.3535533906f, +0.4174197128f, +1.0000000000f, +0.1913417162f, -0.0947343455f, +0.5924659585f,
-0.0000000000f, -0.5924659585f, +0.0947343455f, -0.1913417162f, -1.0000000000f, -0.4174197128f, -0.3535533906f, -1.2552931065f,
-0.8660254038f, -0.4619397663f, -1.3194792169f, -1.1827865776f, -0.5000000000f, -1.1827865776f, -1.3194792169f, -0.4619397663f,
-0.8660254038f, -1.2552931065f, -0.3535533906f, -0.4174197128f, -1.0000000000f, -0.1913417162f, +0.0947343455f, -0.5924659585f,
+0.0000000000f, +0.5924659585f, -0.0947343455f, +0.1913417162f, +1.0000000000f, +0.4174197128f, +0.3535533906f, +1.2552931065f,
+0.8660254038f, +0.4619397663f, +1.3194792169f, +1.1827865776f, +0.5000000000f, +1.1827865776f, +1.3194792169f, +0.4619397663f,
+0.8660254038f, +1.2552931065f, +0.3535533906f, +0.4174197128f, +1.0000000000f, +0.1913417162f, -0.0947343455f, +0.5924659585f,
+0.0000000000f, -0.5924659585f, +0.0947343455f, -0.1913417162f, -1.0000000000f, -0.4174197128f, -0.3535533906f, -1.2552931065f,
-0.8660254038f, -0.4619397663f, -1.3194792169f, -1.1827865776f, -0.5000000000f, -1.1827865776f, -1.3194792169f, -0.4619397663f,
-0.8660254038f, -1.2552931065f, -0.3535533906f, -0.4174197128f, -1.0000000000f, -0.1913417162f, +0.0947343455f, -0.5924659585f,
-0.0000000000f, +0.5924659585f, -0.0947343455f, +0.1913417162f, +1.0000000000f, +0.4174197128f, +0.3535533906f, +1.2552931065f,
+0.8660254038f, +0.4619397663f, +1.3194792169f, +1.1827865776f, +0.5000000000f, +1.1827865776f, +1.3194792169f, +0.4619397663f,
+0.8660254038f, +1.2552931065f, +0.3535533906f, +0.4174197128f, +1.0000000000f, +0.1913417162f, -0.0947343455f, +0.5924659585f,
+0.0000000000f, -0.5924659585f, +0.0947343455f, -0.1913417162f, -1.0000000000f, -0.4174197128f, -0.3535533906f, -1.2552931065f,
-0.8660254038f, -0.4619397663f, -1.3194792169f, -1.1827865776f, -0.5000000000f, -1.1827865776f, -1.3194792169f, -0.4619397663f,
-0.8660254038f, -1.2552931065f, -0.3535533906f, -0.4174197128f, -1.0000000000f, -0.1913417162f, +0.0947343455f, -0.5924659585f,
-0.0000000000f, +0.5924659585f, -0.0947343455f, +0.1913417162f, +1.0000000000f, +0.4174197128f, +0.3535533906f, +1.2552931065f,
+0.8660254038f, +0.4619397663f, +1.3194792169f, +1.1827865776f, +0.5000000000f, +1.1827865776f, +1.3194792169f, +0.4619397663f,
+0.8660254038f, +1.2552931065f, +0.3535533906f, +0.4174197128f, +1.0000000000f, +0.1913417162f, -0.0947343455f, +0.5924659585f,
+0.0000000000f, -0.5924659585f, +0.0947343455f, -0.1913417162f, -1.0000000000f, -0.4174197128f, -0.3535533906f, -1.2552931065f,
};


// Filter kernel [low-pass of 6kHz]
double  Impulse_response[IMPULSE_RESPONSE_LENGTH] = 
{
-0.0018225230f, -0.0015879294f, +0.0000000000f, +0.0036977508f, +0.0080754303f, +0.0085302217f, -0.0000000000f, -0.0173976984f,
-0.0341458607f, -0.0333591565f, +0.0000000000f, +0.0676308395f, +0.1522061835f, +0.2229246956f, +0.2504960933f, +0.2229246956f,
+0.1522061835f, +0.0676308395f, +0.0000000000f, -0.0333591565f, -0.0341458607f, -0.0173976984f, -0.0000000000f, +0.0085302217f,
+0.0080754303f, +0.0036977508f, +0.0000000000f, -0.0015879294f, -0.0018225230f
};

double _640_points_ecg_[ECG_LENGTH]=
{0,0.0010593,0.0021186,0.003178,0.0042373,0.0052966,0.0063559,0.0074153,0.0084746,0.045198,
0.081921,0.11864,0.15537,0.19209,0.22881,0.26554,0.30226,0.33898,0.30226,0.26554,0.22881,
0.19209,0.15537,0.11864,0.081921,0.045198,0.0084746,0.0077684,0.0070621,0.0063559,0.0056497,
0.0049435,0.0042373,0.0035311,0.0028249,0.0021186,0.0014124,0.00070621,0,-0.096045,-0.19209,
-0.28814,-0.073446,0.14124,0.35593,0.57062,0.78531,1,0.73729,0.47458,0.21186,-0.050847,-0.31356,
-0.57627,-0.83898,-0.55932,-0.27966,0,0.00073692,0.0014738,0.0022108,0.0029477,0.0036846,0.0044215,
0.0051584,0.0058954,0.0066323,0.0073692,0.0081061,0.008843,0.00958,0.010317,0.011054,0.011791,0.012528,
0.013265,0.014001,0.014738,0.015475,0.016212,0.016949,0.03484,0.052731,0.070621,0.088512,0.1064,0.12429,
0.14218,0.16008,0.17797,0.16186,0.14576,0.12966,0.11356,0.097458,0.081356,0.065254,0.049153,0.033051,0.016949,
0.013559,0.010169,0.0067797,0.0033898,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0010593,0.0021186,
0.003178,0.0042373,0.0052966,0.0063559,0.0074153,0.0084746,0.045198,0.081921,0.11864,0.15537,0.19209,0.22881,
0.26554,0.30226,0.33898,0.30226,0.26554,0.22881,0.19209,0.15537,0.11864,0.081921,0.045198,0.0084746,0.0077684,
0.0070621,0.0063559,0.0056497,0.0049435,0.0042373,0.0035311,0.0028249,0.0021186,0.0014124,0.00070621,0,-0.096045,
-0.19209,-0.28814,-0.073446,0.14124,0.35593,0.57062,0.78531,1,0.73729,0.47458,0.21186,-0.050847,-0.31356,-0.57627,
-0.83898,-0.55932,-0.27966,0,0.00073692,0.0014738,0.0022108,0.0029477,0.0036846,0.0044215,0.0051584,0.0058954,
0.0066323,0.0073692,0.0081061,0.008843,0.00958,0.010317,0.011054,0.011791,0.012528,0.013265,0.014001,0.014738,
0.015475,0.016212,0.016949,0.03484,0.052731,0.070621,0.088512,0.1064,0.12429,0.14218,0.16008,0.17797,0.16186,
0.14576,0.12966,0.11356,0.097458,0.081356,0.065254,0.049153,0.033051,0.016949,0.013559,0.010169,0.0067797,
0.0033898,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0010593,0.0021186,0.003178,0.0042373,0.0052966,
0.0063559,0.0074153,0.0084746,0.045198,0.081921,0.11864,0.15537,0.19209,0.22881,0.26554,0.30226,0.33898,
0.30226,0.26554,0.22881,0.19209,0.15537,0.11864,0.081921,0.045198,0.0084746,0.0077684,0.0070621,0.0063559,
0.0056497,0.0049435,0.0042373,0.0035311,0.0028249,0.0021186,0.0014124,0.00070621,0,-0.096045,-0.19209,
-0.28814,-0.073446,0.14124,0.35593,0.57062,0.78531,1,0.73729,0.47458,0.21186,-0.050847,-0.31356,
-0.57627,-0.83898,-0.55932,-0.27966,0,0.00073692,0.0014738,0.0022108,0.0029477,0.0036846,
0.0044215,0.0051584,0.0058954,0.0066323,0.0073692,0.0081061,0.008843,0.00958,0.010317,
0.011054,0.011791,0.012528,0.013265,0.014001,0.014738,0.015475,0.016212,0.016949,0.03484,
0.052731,0.070621,0.088512,0.1064,0.12429,0.14218,0.16008,0.17797,0.16186,0.14576,0.12966,
0.11356,0.097458,0.081356,0.065254,0.049153,0.033051,0.016949,0.013559,0.010169,0.0067797,
0.0033898,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0010593,0.0021186,0.003178,
0.0042373,0.0052966,0.0063559,0.0074153,0.0084746,0.045198,0.081921,0.11864,0.15537,0.19209,
0.22881,0.26554,0.30226,0.33898,0.30226,0.26554,0.22881,0.19209,0.15537,0.11864,0.081921,
0.045198,0.0084746,0.0077684,0.0070621,0.0063559,0.0056497,0.0049435,0.0042373,0.0035311,
0.0028249,0.0021186,0.0014124,0.00070621,0,-0.096045,-0.19209,-0.28814,-0.073446,0.14124,
0.35593,0.57062,0.78531,1,0.73729,0.47458,0.21186,-0.050847,-0.31356,-0.57627,-0.83898,-0.55932,
-0.27966,0,0.00073692,0.0014738,0.0022108,0.0029477,0.0036846,0.0044215,0.0051584,0.0058954,
0.0066323,0.0073692,0.0081061,0.008843,0.00958,0.010317,0.011054,0.011791,0.012528,0.013265,
0.014001,0.014738,0.015475,0.016212,0.016949,0.03484,0.052731,0.070621,0.088512,0.1064,0.12429,
0.14218,0.16008,0.17797,0.16186,0.14576,0.12966,0.11356,0.097458,0.081356,0.065254,0.049153,0.033051,
0.016949,0.013559,0.010169,0.0067797,0.0033898,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0010593,
0.0021186,0.003178,0.0042373,0.0052966,0.0063559,0.0074153,0.0084746,0.045198,0.081921,0.11864,0.15537,0.19209,
0.22881,0.26554,0.30226,0.33898,0.30226,0.26554,0.22881,0.19209,0.15537,0.11864,0.081921,0.045198,0.0084746,
0.0077684,0.0070621,0.0063559,0.0056497,0.0049435,0.0042373,0.0035311,0.0028249,0.0021186,0.0014124,0.00070621,
0,-0.096045,-0.19209,-0.28814,-0.073446,0.14124,0.35593,0.57062,0.78531,1,0.73729,0.47458,0.21186,-0.050847,
-0.31356,-0.57627,-0.83898,-0.55932,-0.27966,0,0.00073692,0.0014738,0.0022108,0.0029477,0.0036846,0.0044215,
0.0051584,0.0058954,0.0066323,0.0073692,0.0081061,0.008843,0.00958,0.010317,0.011054,0.011791,0.012528,0.013265,
0.014001,0.014738,0.015475,0.016212,0.016949,0.03484,0.052731,0.070621,0.088512,0.1064,0.12429,0.14218,0.16008,
0.17797,0.16186,0.14576,0.12966,0.11356,0.097458,0.081356,0.065254,0.049153,0.033051,0.016949,0.013559,0.010169,
0.0067797,0.0033898,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

double _320_pts_ecg_IMX[SIGNAL_LENGTH]=
{
    0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.029149,0.000000,-0.000000,-0.000000,-0.000000,
    0.039770,0.000000,0.000000,-0.000000,-0.000000,0.035625,0.000000,0.000000,0.000000,0.000000,
    0.017674,0.000000,0.000000,0.000000,0.000000,-0.099505,-0.000000,-0.000000,-0.000000,-0.000000,
    0.054098,0.000000,0.000000,0.000000,0.000000,-0.030408,-0.000000,-0.000000,0.000000,0.000000,
    -0.046985,-0.000000,-0.000000,-0.000000,-0.000000,0.103129,0.000000,0.000000,0.000000,0.000000,
    -0.074220,-0.000000,-0.000000,-0.000000,-0.000000,0.028076,0.000000,0.000000,-0.000000,-0.000000,
    0.023722,0.000000,0.000000,0.000000,0.000000,-0.045849,-0.000000,-0.000000,-0.000000,-0.000000,
    0.033980,0.000000,0.000000,0.000000,0.000000,-0.012884,-0.000000,-0.000000,-0.000000,-0.000000,
    0.003146,0.000000,0.000000,0.000000,0.000000,-0.004143,-0.000000,-0.000000,-0.000000,-0.000000,
    0.009691,0.000000,0.000000,0.000000,0.000000,-0.004811,-0.000000,0.000000,0.000000,0.000000,
    -0.005449,-0.000000,-0.000000,-0.000000,-0.000000,0.006368,0.000000,0.000000,0.000000,0.000000,
    -0.010325,-0.000000,-0.000000,-0.000000,-0.000000,0.009398,0.000000,0.000000,0.000000,0.000000,
    -0.008365,-0.000000,-0.000000,-0.000000,-0.000000,0.010714,0.000000,0.000000,0.000000,0.000000,
    -0.005858,-0.000000,-0.000000,-0.000000,0.000000,-0.003196,-0.000000,-0.000000,-0.000000,
    -0.000000,0.011550,0.000000,0.000000,0.000000,0.000000,-0.012991,-0.000000,-0.000000,-0.000000,
    -0.000000,0.007205,0.000000,0.000000,0.000000,0.000000,0.000247,0.000000,0.000000,0.000000,
    0.000000,-0.003039,-0.000000,-0.000000,-0.000000,-0.000000,0.003210,0.000000,0.000000,0.000000,
    0.000000,-0.000029,0.000000,0.000000,0.000000,0.000000,-0.002100,-0.000000,-0.000000,-0.000000,
    0.000000,-0.000870,-0.000000,-0.000000,-0.000000,-0.000000,0.001723,0.000000,0.000000,0.000000,
    0.000000,-0.003012,-0.000000,-0.000000,-0.000000,-0.000000,0.002882,0.000000,0.000000,0.000000,
    0.000000,-0.000451,-0.000000,0.000000,0.000000,0.000000,-0.001092,-0.000000,-0.000000,-0.000000,
    -0.000000,0.002272,0.000000,0.000000,0.000000,0.000000,-0.002413,-0.000000,-0.000000,-0.000000,
    -0.000000,0.001425,0.000000,0.000000,0.000000,0.000000,-0.000033,0.000000,0.000000,0.000000,
    0.000000,-0.001375,-0.000000,-0.000000,-0.000000,-0.000000,0.003481,0.000000,0.000000,0.000000,
    0.000000,-0.003222,-0.000000,-0.000000,-0.000000,-0.000000,0.002236,0.000000,0.000000,0.000000,
    0.000000,0.000380,0.000000,0.000000,0.000000,0.000000,-0.004337,-0.000000,-0.000000,-0.000000,
    -0.000000,0.004049,0.000000,0.000000,0.000000,0.000000,-0.002263,-0.000000,-0.000000,-0.000000,
    -0.000000,-0.000074,-0.000000,-0.000000,-0.000000,-0.000000,0.001185,0.000000,0.000000,0.000000,
    -0.000000,0.000501,0.000000,0.000000,0.000000,0.000000,-0.002226,-0.000000,-0.000000,-0.000000,
    -0.000000,0.001419,0.000000,0.000000,-0.000000,-0.000000,0.001537,0.000000,0.000000,0.000000,
    0.000000,-0.004431,-0.000000,-0.000000,-0.000000,-0.000000,0.004903,0.000000,0.000000,0.000000,
    0.000000,-0.002551,-0.000000,-0.000000,-0.000000,-0.000000,0.001560,0.000000,0.000000,0.000000,0.000000
};

double _320_pts_ecg_REX[SIGNAL_LENGTH]=
{
 0.000308,0.000000,0.000000,0.000000,0.000000,0.017278,0.000000,0.000000,0.000000,0.000000,-0.048505,
 -0.000000,-0.000000,-0.000000,-0.000000,0.032647,0.000000,0.000000,0.000000,0.000000,-0.074329,
 -0.000000,-0.000000,-0.000000,0.000000,-0.025191,-0.000000,-0.000000,-0.000000,-0.000000,0.062368,
 0.000000,0.000000,0.000000,0.000000,-0.066539,-0.000000,-0.000000,-0.000000,-0.000000,0.088721,
 0.000000,0.000000,0.000000,0.000000,-0.022441,-0.000000,0.000000,0.000000,0.000000,-0.040285,
 -0.000000,-0.000000,-0.000000,-0.000000,0.068324,0.000000,0.000000,0.000000,0.000000,-0.062202,
 -0.000000,-0.000000,-0.000000,-0.000000,0.023331,0.000000,0.000000,0.000000,-0.000000,0.008082,
 0.000000,0.000000,0.000000,0.000000,-0.016320,-0.000000,-0.000000,-0.000000,-0.000000,0.009143,
 0.000000,0.000000,0.000000,0.000000,-0.002044,-0.000000,-0.000000,-0.000000,-0.000000,0.003641,
 0.000000,0.000000,0.000000,0.000000,-0.014913,-0.000000,-0.000000,-0.000000,-0.000000,0.014010,
 0.000000,0.000000,0.000000,0.000000,-0.009334,-0.000000,-0.000000,-0.000000,-0.000000,0.004675,
 0.000000,0.000000,-0.000000,-0.000000,0.001878,0.000000,0.000000,0.000000,0.000000,-0.001253,
 -0.000000,-0.000000,-0.000000,-0.000000,0.005649,0.000000,0.000000,0.000000,0.000000,-0.012419,
 -0.000000,-0.000000,-0.000000,-0.000000,0.013936,0.000000,0.000000,0.000000,0.000000,-0.008990,
 -0.000000,-0.000000,-0.000000,-0.000000,-0.000689,-0.000000,-0.000000,-0.000000,-0.000000,
 0.008281,0.000000,0.000000,0.000000,0.000000,-0.008168,-0.000000,-0.000000,-0.000000,-0.000000,
 0.003327,0.000000,0.000000,0.000000,0.000000,0.000502,0.000000,0.000000,0.000000,0.000000,
 -0.002153,-0.000000,-0.000000,-0.000000,0.000000,-0.001918,-0.000000,-0.000000,-0.000000,
 -0.000000,0.003255,0.000000,0.000000,0.000000,0.000000,-0.001608,-0.000000,-0.000000,-0.000000,
 -0.000000,0.000513,-0.000000,-0.000000,-0.000000,-0.000000,0.002440,0.000000,0.000000,0.000000,
 0.000000,-0.003065,-0.000000,-0.000000,-0.000000,-0.000000,0.002144,0.000000,0.000000,0.000000,
 0.000000,-0.000942,-0.000000,-0.000000,-0.000000,0.000000,-0.000450,-0.000000,-0.000000,-0.000000,
 -0.000000,0.001742,0.000000,0.000000,0.000000,0.000000,-0.002555,-0.000000,-0.000000,-0.000000,
 -0.000000,0.002953,0.000000,0.000000,0.000000,0.000000,-0.001030,-0.000000,0.000000,0.000000,
 0.000000,-0.002093,-0.000000,-0.000000,-0.000000,-0.000000,0.003387,0.000000,0.000000,0.000000,
 0.000000,-0.004929,-0.000000,-0.000000,-0.000000,-0.000000,0.002647,0.000000,0.000000,0.000000,
 -0.000000,0.001119,0.000000,0.000000,0.000000,0.000000,-0.002469,-0.000000,-0.000000,-0.000000,
 -0.000000,0.002313,0.000000,0.000000,0.000000,0.000000,-0.000296,0.000000,0.000000,0.000000,0.000000,
 -0.000567,-0.000000,-0.000000,0.000000,0.000000,-0.000877,-0.000000,-0.000000,-0.000000,-0.000000,
 0.003141,0.000000,0.000000,0.000000,0.000000,-0.004000,-0.000000,-0.000000,-0.000000,-0.000000,0.002664,
 0.000000,0.000000,0.000000,-0.000000,0.000851,0.000000,0.000000,0.000000,0.000000,-0.002816,-0.000000,
 -0.000000,-0.000000,-0.000000,0.003250,0.000000,0.000000,0.000000,0.000000,
};

double _501pts_20Hz_sig_imx[ECG_LENGTH_2]=
{
    0,0.95106,0.58779,-0.58779,-0.95106,-2.4493e-16,0.95106,0.58779,-0.58779,-0.95106,-4.8986e-16,
    0.95106,0.58779,-0.58779,-0.95106,-7.3479e-16,0.95106,0.58779,-0.58779,-0.95106,-9.7972e-16,
    0.95106,0.58779,-0.58779,-0.95106,-1.2246e-15,0.95106,0.58779,-0.58779,-0.95106,-1.4696e-15,
    0.95106,0.58779,-0.58779,-0.95106,5.3909e-15,0.95106,0.58779,-0.58779,-0.95106,-1.9594e-15,
    0.95106,0.58779,-0.58779,-0.95106,-2.2044e-15,0.95106,0.58779,-0.58779,-0.95106,-2.4493e-15,
    0.95106,0.58779,-0.58779,-0.95106,4.4112e-15,0.95106,0.58779,-0.58779,-0.95106,-2.9392e-15,
    0.95106,0.58779,-0.58779,-0.95106,3.9213e-15,0.95106,0.58779,-0.58779,-0.95106,1.0782e-14,
    0.95106,0.58779,-0.58779,-0.95106,-1.0779e-14,0.95106,0.58779,-0.58779,-0.95106,-3.9189e-15,
    0.95106,0.58779,-0.58779,-0.95106,-1.1269e-14,0.95106,0.58779,-0.58779,-0.95106,-4.4087e-15,
    0.95106,0.58779,-0.58779,-0.95106,2.4518e-15,0.95106,0.58779,-0.58779,-0.95106,-4.8986e-15,
    0.95106,0.58779,-0.58779,-0.95106,1.9619e-15,0.95106,0.58779,-0.58779,-0.95106,8.8224e-15,
    0.95106,0.58779,-0.58779,-0.95106,1.5683e-14,0.95106,0.58779,-0.58779,-0.95106,-5.8783e-15,
    0.95106,0.58779,-0.58779,-0.95106,9.8219e-16,0.95106,0.58779,-0.58779,-0.95106,7.8427e-15,
    0.95106,0.58779,-0.58779,-0.95106,1.4703e-14,0.95106,0.58779,-0.58779,-0.95106,2.1564e-14,
    0.95106,0.58779,-0.58779,-0.95106,2.4759e-18,0.95106,0.58779,-0.58779,-0.95106,-2.1559e-14,
    0.95106,0.58779,-0.58779,-0.95106,-1.4698e-14,0.95106,0.58779,-0.58779,-0.95106,-7.8377e-15,
    0.95106,0.58779,-0.58779,-0.95106,-9.7724e-16,0.95106,0.58779,-0.58779,-0.95106,-2.2538e-14,
    0.95106,0.58779,-0.58779,-0.95106,-1.5678e-14,0.95106,0.58779,-0.58779,-0.95106,-8.8175e-15,
    0.95106,0.58779,-0.58779,-0.95106,-1.957e-15,0.95106,0.58779,-0.58779,-0.95106,4.9035e-15,
    0.95106,0.58779,-0.58779,-0.95106,-1.6658e-14,0.95106,0.58779,-0.58779,-0.95106,-9.7972e-15,
    0.95106,0.58779,-0.58779,-0.95106,-3.1358e-14,0.95106,0.58779,-0.58779,-0.95106,3.9238e-15,
    0.95106,0.58779,-0.58779,-0.95106,-1.7637e-14,0.95106,0.58779,-0.58779,-0.95106,1.7645e-14,
    0.95106,0.58779,-0.58779,-0.95106,-3.9164e-15,0.95106,0.58779,-0.58779,-0.95106,3.1366e-14,
    0.95106,0.58779,-0.58779,-0.95106,9.8046e-15,0.95106,0.58779,-0.58779,-0.95106,-1.1757e-14,
    0.95106,0.58779,-0.58779,-0.95106,2.3526e-14,0.95106,0.58779,-0.58779,-0.95106,1.9644e-15,
    0.95106,0.58779,-0.58779,-0.95106,-1.9597e-14,0.95106,0.58779,-0.58779,-0.95106,1.5685e-14,
    0.95106,0.58779,-0.58779,-0.95106,-5.8758e-15,0.95106,0.58779,-0.58779,-0.95106,-2.7437e-14,
    0.95106,0.58779,-0.58779,-0.95106,7.8452e-15,0.95106,0.58779,-0.58779,-0.95106,-1.3716e-14,
    0.95106,0.58779,-0.58779,-0.95106,2.1566e-14,0.95106,0.58779,-0.58779,-0.95106,4.9518e-18,
    0.95106,0.58779,-0.58779,-0.95106,3.5287e-14,0.95106,0.58779,-0.58779,-0.95106,-4.3117e-14,
    0.95106,0.58779,-0.58779,-0.95106,-6.4679e-14,0.95106,0.58779,-0.58779,-0.95106,-8.624e-14,
    0.95106,0.58779,-0.58779,-0.95106,-5.0958e-14,0.95106,0.58779,-0.58779,-0.95106,-1.5675e-14,
    0.95106,0.58779,-0.58779,-0.95106,-3.7237e-14,0.95106,0.58779,-0.58779,-0.95106,-5.8798e-14,
    0.95106,0.58779,-0.58779,-0.95106,-8.0359e-14,0.95106,0.58779,-0.58779,-0.95106,-4.5077e-14,
    0.95106,0.58779,-0.58779,-0.95106,-9.7947e-15,0.95106,0.58779,-0.58779,-0.95106,-3.1356e-14,
    0.95106,0.58779,-0.58779,-0.95106,-5.2917e-14,0.95106,0.58779,-0.58779,-0.95106,-7.4478e-14,
    0.95106,0.58779,-0.58779,-0.95106,-3.9196e-14,0.95106,0.58779,-0.58779,-0.95106,-3.9139e-15,
    0.95106,0.58779,-0.58779,-0.95106,-2.5475e-14,0.95106,0.58779,-0.58779,-0.95106,-4.7036e-14,
    0.95106,0.58779,-0.58779,-0.95106,-6.8598e-14,0.95106,0.58779,-0.58779,-0.95106,-3.3315e-14,
    0.95106,0.58779,-0.58779,-0.95106,1.9669e-15,0.95106,0.58779,-0.58779,-0.95106,-1.9594e-14,
    0.95106,0.58779,-0.58779,-0.95106,-4.1156e-14,0.95106,0.58779,-0.58779,-0.95106,-6.2717e-14,
    0.95106,0.58779,-0.58779,-0.95106,2.9409e-14,0.95106,0.58779,-0.58779,-0.95106,7.8476e-15,
    0.95106,0.58779,-0.58779,-0.95106,-1.3714e-14,0.95106,0.58779,-0.58779,-0.95106,-3.5275e-14,
    0.95106,0.58779,-0.58779,-0.95106,-5.6836e-14,0.95106,0.58779,-0.58779,-0.95106,3.529e-14,
    0.95106,0.58779,-0.58779,-0.95106,1.3728e-14,0.95106,0.58779,-0.58779,-0.95106,-7.8328e-15,
    0.95106,0.58779,-0.58779,-0.95106,-2.9394e-14,0.95106,0.58779,-0.58779,-0.95106,-5.0955e-14,
    0.95106,0.58779,-0.58779,-0.95106,4.117e-14,0.95106,0.58779,-0.58779,-0.95106,1.9609e-14,
    0.95106,0.58779,-0.58779,-0.95106,-1.952e-15,0.95106,0.58779,-0.58779,-0.95106,-2.3513e-14,
    0.95106,0.58779,-0.58779,-0.95106,-4.5074e-14,0.95106,0.58779,-0.58779,-0.95106,4.7051e-14,
    0.95106,0.58779,-0.58779,-0.95106,2.549e-14,0.95106,0.58779,-0.58779,-0.95106,3.9288e-15

};

double _501pts_20Hz_sig_rex[ECG_LENGTH_2]=
{
    1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,
    0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,
    -0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1,0.30902,-0.80902,-0.80902,0.30902,1

};

double OutputSignal[SIGNAL_LENGTH-KERNEL_LENGTH]; // signal length + impulse length for convolution, signal length for running sum, singal length - kernel length for filters
double OutputREX[ECG_LENGTH/2];
double OutputIMX[ECG_LENGTH/2];
double OutputIDFT[ECG_LENGTH];
double OutputMAG[ECG_LENGTH];
double OutputMagnitude[SIGNAL_LENGTH];
double OutputPhase[SIGNAL_LENGTH];
double OutputFilter[KERNEL_LENGTH];
double state_lower_cutoff_buffer[KERNEL_LENGTH];
double state_upper_cutoff_buffer[KERNEL_LENGTH];
double calc_mean(double *sig_src_array, int length);
double calc_variance(double *sig_src_array, double mean, int length);
double calc_std(double variance);
void convolution(double *signal_src_array, double *signal_destination_array, double *impulse_response_array, int signal_src_length, int impulse_response_length);
void running_sum(double *signal_src_array, double *signal_destination_array, int length);
void calc_dft(double *signal_src_array, double *signal_destination_rex_array, double *signal_destination_imx_array, int length);
void calc_idft(double *idft_out_array, double *signal_src_rex_array, double *signal_src_imx_array, int length);
void get_dft_output_mag(double *sig_dest_mag_arr, int length); 
void rect_to_polar(double *signal_src_rex_array, double *signal_src_imx_array, double *signal_out_mag_array, double *signal_out_phase_array, int length);
void complex_dft(double *signal_src_time_domain_rex, double *signal_src_time_domain_imx, double *signal_destination_freq_domain_rex, double *signal_destination_freq_domain_imx, int length);
void low_pass_windowed_sinc_filter(double *signal_src_array, double *signal_destination_array, double *filter_kernel_destination_array, double cutoff_freq, int filter_length, int input_singal_length);
void band_pass_windowed_sinc_filter(double *lower_cutoff_state_buffer, double *upper_cutoff_state_buffer,
                                    double *filter_kernel_destination_array, double lower_cutoff,
                                    double upper_cutoff, int filter_length, double *signal_src_array,
                                    double *signal_destination_array, int input_signal_length);
double sig_mean = 0.0;
double sig_variance = 0.0;
double sig_std = 0.0;
double cutoff = 0.2;
double lower_cutoff = 0.002; // 10kHz -> (0.1/24)*0.5=0.002
double upper_cutoff = 0.11; // 10kHz -> (5.28/24)*0.5=0.11

int main() {
    FILE *input_signal_fptr,  *output_signal_fptr, *output_filter_fptr;

    band_pass_windowed_sinc_filter(&state_lower_cutoff_buffer[0], 
                                   &state_upper_cutoff_buffer[0], 
                                   &OutputFilter[0], lower_cutoff, 
                                   upper_cutoff, KERNEL_LENGTH, 
                                   &InputSignal_f32_1kHz_15kHz[0], 
                                   &OutputSignal[0], SIGNAL_LENGTH);

    input_signal_fptr = fopen("input_signal.dat", "w");
    output_signal_fptr = fopen("output_signal.dat", "w");
    output_filter_fptr = fopen("output_filter.dat", "w");

    for (int i = 0; i < SIGNAL_LENGTH; i++)
    {
        fprintf(input_signal_fptr, "\n%f", InputSignal_f32_1kHz_15kHz[i]);
        if (i>=KERNEL_LENGTH) {
        fprintf(output_signal_fptr, "\n%f", OutputSignal[i]);
    }
    if (i<KERNEL_LENGTH) {
        fprintf(output_filter_fptr, "\n%f", OutputFilter[i]);
    }
    }

    fclose(input_signal_fptr);
    fclose(output_signal_fptr);
    fclose(output_filter_fptr);
    
    return 0;
}


// Signal mean calculation algorithm
double calc_mean(double *sig_src_array, int length) {
    double mean = 0.0;

    for(int i=0; i<length; i++){
         mean = mean + sig_src_array[i];
    }

mean = mean/(double)length;
return mean;
}

// Signal variance calculation algorithm
double calc_variance(double *sig_src_array, double mean, int length) {
    double variance = 0.0;

    for (int i =0; i<length; i++){
        variance = variance + pow((sig_src_array[i]-mean), 2);
    }

    variance = variance/(length-1);

    return variance;
}

// Signal standard deviation calculation algorithm
double calc_std(double variance) {
    double std = sqrt(variance);
    return std;
}

// Signal colvolution algorithm
void convolution(double *signal_src_array, 
                 double *signal_destination_array,  
                 double *impulse_response_array,
                 int signal_src_length,
                 int impulse_response_length) {
    int i, j;
    for(i=0; i<signal_src_length; i++) {
        signal_destination_array[i] = 0;
    }

    for (int i = 0; i < signal_src_length; i++)
    {
        for (int j = 0; j < impulse_response_length; j++)
        {
            signal_destination_array[i+j] = signal_destination_array[i+j] + signal_src_array[i]*impulse_response_array[j];
        }
        
    }
    
}

// Running sum algorithm
void running_sum(double *signal_src_array,
                 double *signal_destination_array,
                 int length) {
    for (int i = 0; i < length; i++)
    {
        signal_destination_array[i] = signal_destination_array[i-1] + signal_src_array[i];
    }
    
}

// DFT calculation algorithm
void calc_dft(double *signal_src_array, 
              double *signal_destination_rex_array,
              double *signal_destination_imx_array,
              int length) {
    int i, j, k;

    for (int j = 0; j < length/2; j++)
    {
        signal_destination_rex_array[j]=0;
        signal_destination_imx_array[j]=0;
    }

    for (int k = 0; k < length/2; k++)
    {
        for (int i = 0; i < length; i++)
        {
            signal_destination_rex_array[k] = signal_destination_rex_array[k] + signal_src_array[i]*cos((2*M_PI*k*i)/length);
            signal_destination_imx_array[k] = signal_destination_imx_array[k] - signal_src_array[i]*sin((2*M_PI*k*i)/length);
        }
        
    }
     
}

// IDFT calculation algorithm
void calc_idft(double *idft_out_array, 
              double *signal_src_rex_array,
              double *signal_src_imx_array,
              int length) {
    int i, k;

    for (int k = 0; k < length/2; k++)
    {
        signal_src_rex_array[k] = signal_src_rex_array[k]/(length/2);
        signal_src_imx_array[k] = -signal_src_imx_array[k]/(length/2);
    }
      
    signal_src_rex_array[0] = signal_src_rex_array[0]/(length/2);
    signal_src_imx_array[0] = -signal_src_imx_array[0]/(length/2);
    
    for (int i = 0; i < length/2; i++)
    {
        idft_out_array[i] =  0;
    }
    for (int k = 0; k < length/2; k++)
    {
        for (int i = 0; i < length; i++)
        {
            idft_out_array[i] = idft_out_array[i] + signal_src_rex_array[k]*cos((2*M_PI*k*i)/length);
            idft_out_array[i] = idft_out_array[i] + signal_src_imx_array[k]*sin((2*M_PI*k*i)/length);
        }
        
    }
    
    
}

// Get DFT output magnitude
 void get_dft_output_mag(double *sig_dest_mag_arr, int length)
 {

     int k;
     for(k=0;k<length/2;k++)
     {
         sig_dest_mag_arr[k] = sqrt(pow(OutputREX[k],2)+pow(OutputIMX[k],2));
     }
 }


// Rectangular notation to polar notation
void rect_to_polar(double *signal_src_rex_array,
                   double *signal_src_imx_array,
                   double *signal_out_mag_array,
                   double *signal_out_phase_array,
                   int length) {
    int i;
    for (int i = 0; i < length; i++)
    {
        signal_out_mag_array[i] = sqrt(powf(signal_src_rex_array[i], 2) + powf(signal_src_imx_array[i], 2));
        if(signal_src_rex_array[i] == 0){
            signal_src_rex_array[i] = pow(10, -20);
            signal_out_phase_array[i] = atan(signal_src_imx_array[i]/signal_src_rex_array[i]);
        }

        if((signal_src_rex_array[i]<0)&&(signal_src_imx_array<0)) {
            signal_out_phase_array[i]= signal_out_phase_array[i]-M_PI;
        }

        if((signal_src_rex_array[i]<0)&&(signal_src_imx_array[i]>=0)) {
            signal_out_phase_array[i] = signal_out_phase_array[i]+M_PI;
        }
    }
    
}

// Complex DFT calculation
void complex_dft(double *signal_src_time_domain_rex, double *signal_src_time_domain_imx,
                 double *signal_destination_freq_domain_rex, double *signal_destination_freq_domain_imx,
                 int length) {
                    double real, imaginary;
                    for (int i = 0; i < length-1; i++)
                    {
                        for (int j = 0; j < length-1; j++)
                        {
                            real = cos((2*M_PI*i*j)/length);
                            imaginary = -sin((2*M_PI*i*j)/length);

                            signal_destination_freq_domain_rex[i] = signal_destination_freq_domain_rex[i] + signal_src_time_domain_rex[j]*real - signal_src_time_domain_imx[j]*imaginary;
                            signal_destination_freq_domain_imx[i] = signal_destination_freq_domain_imx[i] + signal_src_time_domain_imx[j]*imaginary - signal_src_time_domain_imx[j]*real;
                        }
                        
                    }
                    
                 }

// Low-pass windowed-sinc filter 
void low_pass_windowed_sinc_filter(double *signal_src_array, double *signal_destination_array,
                                   double *filter_kernel_destination_array, double cutoff_freq,
                                   int filter_length, int input_singal_length) {

// Low-pass filter kernel calculation
for (int i = 0; i < filter_length; i++)
{
    if(i - filter_length/2 == 0) {
        filter_kernel_destination_array[i] = 2*M_PI*cutoff_freq;
    }
    if(i - filter_length/2 != 0) {
        filter_kernel_destination_array[i] = sin(2*M_PI*cutoff_freq*(i-filter_length/2)/(i-filter_length/2));
        filter_kernel_destination_array[i] = filter_kernel_destination_array[i] * (0.54-0.46*cos(2*M_PI*i/filter_length));
    }
}

// Convolution of input signal and filter kernel
for (int j = filter_length; j < input_singal_length; j++)
{
    signal_destination_array[j] = 0;
    for (int i = 0; i < filter_length; i++)
    {
        signal_destination_array[j] = signal_destination_array[j] + signal_src_array[j-i] * filter_kernel_destination_array[i];
    }
    
}

}

void band_pass_windowed_sinc_filter(double *lower_cutoff_state_buffer,
                                    double *upper_cutoff_state_buffer,
                                    double *filter_kernel_destination_array,
                                    double lower_cutoff,
                                    double upper_cutoff,
                                    int filter_length,
                                    double *signal_src_array,
                                    double *signal_destination_array,
                                    int input_signal_length) {
    // Low-pass filter kernel calculation
    for (int i = 0; i < filter_length; i++)
{
    if(i - filter_length/2 == 0) {
        lower_cutoff_state_buffer[i] = 2*M_PI*lower_cutoff;
    }
    if(i - filter_length/2 != 0) {
       lower_cutoff_state_buffer[i] = sin(2*M_PI*lower_cutoff*(i-filter_length/2));
       lower_cutoff_state_buffer[i] = lower_cutoff_state_buffer[i]*(0.42-0.5*cos(2*M_PI*i/filter_length)+0.08*cos(4*M_PI*i/filter_length));
    }
}

// Second low-pass filter kernel calculation
    for (int i = 0; i < filter_length; i++)
{
    if(i - filter_length/2 == 0) {
        upper_cutoff_state_buffer[i] = 2*M_PI*upper_cutoff;
    }
    if(i - filter_length/2 != 0) {
       upper_cutoff_state_buffer[i] = sin(2*M_PI*upper_cutoff*(i-filter_length/2)/(i-filter_length/2));
       upper_cutoff_state_buffer[i] = upper_cutoff_state_buffer[i]*(0.42-0.5*cos(2*M_PI*i/filter_length)+0.08*cos(4*M_PI*i/filter_length));
    }
}

// Change low-pass filter to a high-pass filter using Spectral Inversion
for (int i = 0; i < filter_length; i++) 
{
    upper_cutoff_state_buffer[i] = -(upper_cutoff_state_buffer[i]);
}

upper_cutoff_state_buffer[filter_length/2] = upper_cutoff_state_buffer[filter_length/2]+1;


// Add low-pass filter kernel to high-pass filter kernel to reject a band-reject filter kernel
for (int i = 0; i < filter_length; i++)
{
    filter_kernel_destination_array[i] = lower_cutoff_state_buffer[i] + upper_cutoff_state_buffer[i];
}

// Change band-reject filter into bandpass filter using Spectral Inversion

for (int i = 0; i < filter_length; i++)
{
    filter_kernel_destination_array[i] = -(filter_kernel_destination_array[i]);
}

filter_kernel_destination_array[filter_length/2] = filter_kernel_destination_array[filter_length/2]+1;

// Convolution of input signal and the filter kernel

for (int j = filter_length; j < input_signal_length; j++)
{
    signal_destination_array[j] = 0;
    for (int i = 0; i < filter_length; i++)
    {
        signal_destination_array[j] = signal_destination_array[j] + signal_src_array[j-i]*filter_kernel_destination_array[i];
    }
    
}

}

// // Display
//     // Mean of input signal
//     sig_mean = calc_mean(&InputSignal_f32_1kHz_15kHz[0], SIGNAL_LENGTH);
//     printf("Mean = %f\n", sig_mean);

//     // Variance of input signal
//     sig_variance = calc_variance(&InputSignal_f32_1kHz_15kHz[0], sig_mean, SIGNAL_LENGTH);
//     printf("Variance = %f\n", sig_variance);

//     // Standard deviation of input signal
//     sig_std = calc_std(sig_variance);
//     printf("Standard deviation = %f\n", sig_std);

    // // Writing to files
    // FILE *input_sig_fptr, *imp_rsp_fptr;
    // input_sig_fptr = fopen("input_signal.dat", "w");
    // imp_rsp_fptr = fopen("impulse_response.dat", "w");

    // for (int i = 0; i < SIGNAL_LENGTH; i++)
    // {
    //     fprintf(input_sig_fptr, "\n%f", InputSignal_f32_1kHz_15kHz[i]);
    // }
    // fclose(input_sig_fptr);

    // for (int i = 0; i < IMPULSE_RESPONSE_LENGTH; i++)
    // {
    //     fprintf(imp_rsp_fptr, "\n%f", Impulse_response[i]);
    // }
    // fclose(imp_rsp_fptr);

// // Convolution writing to files
//     FILE *input_sig_fptr, *imp_rsp_fptr, *output_sig_fptr;

//     convolution(&InputSignal_f32_1kHz_15kHz[0],
//                 &OutputSignal[0],
//                 &Impulse_response[0],
//                 SIGNAL_LENGTH,
//                 IMPULSE_RESPONSE_LENGTH); 

//     input_sig_fptr = fopen("input_signal.dat", "w");
//     imp_rsp_fptr = fopen("impulse_response.dat", "w");
//     output_sig_fptr = fopen("output_signal.dat", "w");

//     for (int i = 0; i < SIGNAL_LENGTH; i++)
//     {
//         fprintf(input_sig_fptr, "\n%f", InputSignal_f32_1kHz_15kHz[i]);
//     }
//     fclose(input_sig_fptr);

//     for (int i = 0; i < IMPULSE_RESPONSE_LENGTH; i++)
//     {
//         fprintf(imp_rsp_fptr, "\n%f", Impulse_response[i]);
//     }
//     fclose(imp_rsp_fptr);

//     for (int i = 0; i < SIGNAL_LENGTH + IMPULSE_RESPONSE_LENGTH; i++)
//     {
//         fprintf(output_sig_fptr, "\n%f", OutputSignal[i]);
//     }
//     fclose(output_sig_fptr);

// // Running sum writing to files
//     FILE *input_sig_fptr, *output_sig_fptr;

//     running_sum(&InputSignal_f32_1kHz_15kHz[0], &OutputSignal[0], SIGNAL_LENGTH);

//     input_sig_fptr = fopen("input_signal.dat", "w");
//     output_sig_fptr = fopen("output_signal.dat", "w");

//     for (int i = 0; i < SIGNAL_LENGTH; i++)
//     {
//         fprintf(input_sig_fptr, "\n%f", InputSignal_f32_1kHz_15kHz[i]);
//     }
//     fclose(input_sig_fptr);



//     for (int i = 0; i < SIGNAL_LENGTH; i++)
//     {
//         fprintf(output_sig_fptr, "\n%f", OutputSignal[i]);
//     }
//     fclose(output_sig_fptr);



// // DFT + IDFT writing to files

//     FILE *input_sig_fptr, *output_rex_fptr, *output_imx_fptr, *output_idft_fptr;

//     calc_dft(&InputSignal_f32_1kHz_15kHz[0], &OutputREX[0], &OutputREX[0], SIGNAL_LENGTH);
//     calc_idft(&OutputIDFT[0], &OutputREX[0], &OutputIMX[0], SIGNAL_LENGTH);

//     input_sig_fptr = fopen("input_signal.dat", "w");
//     output_rex_fptr = fopen("output_rex.dat", "w");
//     output_imx_fptr = fopen("output_imx.dat", "w");
//     output_idft_fptr = fopen("output_idft.dat", "w");

//     for (int i = 0; i < SIGNAL_LENGTH; i++)
//     {
//         fprintf(input_sig_fptr, "\n%f", InputSignal_f32_1kHz_15kHz[i]);
//     }
    
//     for (int i = 0; i < SIGNAL_LENGTH/2; i++)
//     {
//         fprintf(output_rex_fptr, "\n%f", OutputREX[i]);
//         fprintf(output_imx_fptr, "\n%f", OutputIMX[i]);
//         fprintf(output_idft_fptr, "\n%f", OutputIDFT[i]);
//     }
//     fclose(input_sig_fptr);
//     fclose(output_rex_fptr);
//     fclose(output_imx_fptr);
//     fclose(output_idft_fptr);


// // Computing IDFT and DFT of ECG signal
//     FILE *input_sig_fptr, *output_rex_fptr, *output_imx_fptr, *output_idft_fptr, *output_mag_fptr;

//     calc_dft(&_640_points_ecg_[0], &OutputREX[0], &OutputREX[0], ECG_LENGTH);
//     get_dft_output_mag(&OutputMAG[0], ECG_LENGTH);
//     calc_idft(&OutputIDFT[0], &OutputREX[0], &OutputIMX[0], ECG_LENGTH);

//     input_sig_fptr = fopen("input_signal.dat", "w");
//     output_rex_fptr = fopen("output_rex.dat", "w");
//     output_imx_fptr = fopen("output_imx.dat", "w");
//     output_idft_fptr = fopen("output_idft.dat", "w");
//     output_mag_fptr = fopen("output_mag.dat", "w");

//     for (int i = 0; i < ECG_LENGTH; i++)
//     {
//         fprintf(input_sig_fptr, "\n%f", _640_points_ecg_[i]);
//     }
    
//     for (int i = 0; i < ECG_LENGTH/2; i++)
//     {
//         fprintf(output_rex_fptr, "\n%f", OutputREX[i]);
//         fprintf(output_imx_fptr, "\n%f", OutputIMX[i]);
//         fprintf(output_idft_fptr, "\n%f", OutputIDFT[i]);
//         fprintf(output_mag_fptr, "\n%f", OutputMAG[i]);
//     }
//     fclose(input_sig_fptr);
//     fclose(output_rex_fptr);
//     fclose(output_imx_fptr);
//     fclose(output_idft_fptr);
//     fclose(output_mag_fptr);


// // Recangular to polar conversion
//     FILE *input_rex_fptr, *input_imx_fptr, *output_mag_fptr, *output_phase_fptr;

//     rect_to_polar(&_320_pts_ecg_REX[0], &_320_pts_ecg_IMX[0], &OutputMagnitude[0], &OutputPhase[0], SIGNAL_LENGTH);

//     input_rex_fptr = fopen("input_rex.dat", "w");
//     input_imx_fptr = fopen("input_imx.dat", "w");
//     output_mag_fptr = fopen("output_mag.dat", "w");
//     output_phase_fptr = fopen("output_phase.dat", "w");

//     for (int i = 0; i < SIGNAL_LENGTH; i++)
//     {
//         fprintf(input_rex_fptr, "\n%f", _320_pts_ecg_REX[i]);
//         fprintf(input_imx_fptr, "\n%f", _320_pts_ecg_IMX[i]);
//         fprintf(output_mag_fptr, "\n%f", OutputMagnitude[i]);
//         fprintf(output_phase_fptr, "\n%f", OutputPhase[i]);
//     }

//     fclose(input_rex_fptr);
//     fclose(input_imx_fptr);
//     fclose(output_mag_fptr);
//     fclose(output_phase_fptr);
    
// // Complex DFT writing to file
//     FILE *input_rex_fptr, *input_imx_fptr, *output_rex_fptr, *output_imx_fptr;

//     complex_dft(&_501pts_20Hz_sig_rex[0], &_501pts_20Hz_sig_imx[0], &OutputREX[0], &OutputIMX[0], ECG_LENGTH_2);

//     input_rex_fptr = fopen("input_rex.dat", "w");
//     input_imx_fptr = fopen("input_imx.dat", "w");
//     output_rex_fptr = fopen("output_rex.dat", "w");
//     output_imx_fptr = fopen("output_imx.dat", "w");

//     for (int i = 0; i < ECG_LENGTH_2; i++)
//     {
//         fprintf(input_rex_fptr, "\n%f", _501pts_20Hz_sig_rex[i]);
//         fprintf(input_imx_fptr, "\n%f", _501pts_20Hz_sig_imx[i]);
//         fprintf(output_rex_fptr, "\n%f", OutputREX[i]);
//         fprintf(output_imx_fptr, "\n%f", OutputIMX[i]);
//     }

//     fclose(input_rex_fptr);
//     fclose(input_imx_fptr);
//     fclose(output_rex_fptr);
//     fclose(output_imx_fptr);    


// // Low-pass writing to file
//     FILE *input_signal_fptr,  *output_signal_fptr, *output_filter_fptr;

//     low_pass_windowed_sinc_filter(&InputSignal_f32_1kHz_15kHz[0], &OutputSignal[0], &OutputFilter[0], cutoff, KERNEL_LENGTH, SIGNAL_LENGTH);

//     input_signal_fptr = fopen("input_signal.dat", "w");
//     output_signal_fptr = fopen("output_signal.dat", "w");
//     output_filter_fptr = fopen("output_filter.dat", "w");

//     for (int i = 0; i < SIGNAL_LENGTH; i++)
//     {
//         fprintf(input_signal_fptr, "\n%f", InputSignal_f32_1kHz_15kHz[i]);
//         if (i>=KERNEL_LENGTH) {
//         fprintf(output_signal_fptr, "\n%f", OutputSignal[i]);
//     }
//     if (i<KERNEL_LENGTH) {
//         fprintf(output_filter_fptr, "\n%f", OutputFilter[i]);
//     }
//     }

//     fclose(input_signal_fptr);
//     fclose(output_signal_fptr);
//     fclose(output_filter_fptr);

// // Band-pass filter writing to file
// FILE *input_signal_fptr,  *output_signal_fptr, *output_filter_fptr;

//     band_pass_windowed_sinc_filter(&state_lower_cutoff_buffer[0], 
//                                    &state_upper_cutoff_buffer[0], 
//                                    &OutputFilter[0], lower_cutoff, 
//                                    upper_cutoff, KERNEL_LENGTH, 
//                                    &InputSignal_f32_1kHz_15kHz[0], 
//                                    &OutputSignal[0], SIGNAL_LENGTH);

//     input_signal_fptr = fopen("input_signal.dat", "w");
//     output_signal_fptr = fopen("output_signal.dat", "w");
//     output_filter_fptr = fopen("output_filter.dat", "w");

//     for (int i = 0; i < SIGNAL_LENGTH; i++)
//     {
//         fprintf(input_signal_fptr, "\n%f", InputSignal_f32_1kHz_15kHz[i]);
//         if (i>=KERNEL_LENGTH) {
//         fprintf(output_signal_fptr, "\n%f", OutputSignal[i]);
//     }
//     if (i<KERNEL_LENGTH) {
//         fprintf(output_filter_fptr, "\n%f", OutputFilter[i]);
//     }
//     }

//     fclose(input_signal_fptr);
//     fclose(output_signal_fptr);
//     fclose(output_filter_fptr);
    
